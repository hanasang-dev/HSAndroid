#!/bin/sh

echo "ğŸ” Running Spotless Check..."

./gradlew spotlessCheck --quiet

if [ $? -ne 0 ]; then
  echo "âŒ Spotless Check failed. Running spotlessApply..."
  ./gradlew spotlessApply --quiet

  echo "ğŸ“‚ Applying changes..."
  git add .

  echo "âœ… Spotless format applied. Please review the changes."
  echo "Aborting commit so you can verify."
  exit 1
fi

echo "âœ… Spotless Check passed."
echo "ğŸ” Running Detekt..."
./gradlew detekt --quiet
if [ $? -ne 0 ]; then
  echo "âŒ Detekt failed."
  echo "Please fix the issues before committing."
  exit 1
fi
echo "âœ… Detekt passed."

echo "ğŸ” Running Dependency Updates Check..."
./gradlew dependencyUpdates --quiet
git add report.json

echo "âœ… Spotless and Dependency Updates completed."

echo "ğŸ” Running Dependency Guard"
./gradlew :core:presentation:portal:dependencyGuard --quiet --no-daemon
./gradlew :core:presentation:state:dependencyGuard --quiet --no-daemon

if [ $? -eq 0 ]; then
  echo "[`date '+%H:%M:%S'`] âœ… Dependency Guard baseline updated."
  git add core/dependencies/
else
  echo "âŒ Dependency Guard failed. Please investigate."
  exit 1
fi

echo "âœ… All checks passed."

exit 0